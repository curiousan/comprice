
<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <title>Comprice</title>
    <script src="https://code.getmdl.io/1.2.1/material.min.js"></script>
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.light_green-indigo.min.css">
    <!-- Material Design icon font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script>
        componentHandler.upgradeAllRegistered();
    </script>
    <!--jQueryUI -->
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/productDetails/details.css">
    <!--Custom Css-->
    <style>
        #map {
            height:500px;
            width:65%;
            border:5px solid  #FDFDFD;
        }
    </style>
</head>
<body ng-controller="mapController">
<header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
        <div class="mdl-layout-title">
            <a href="#/"><img id="logo" src="images/comprice3.png"/></a>
        </div>
        <div class="mdl-layout-spacer"></div>
        <a href="#/"><button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" style="margin-left:60px;margin-top: 35px;">
            Home
        </button></a>
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" style="margin-left:20px;margin-top: 35px;">
            Contact
        </button>

    </div>
</header>
<div >
<div id="map" style="float:left;margin-top:30px;margin-left:30px;"></div>
<div id="shopDetails" style="float:left; margin-top:50px;padding-left:24px;">

    <h4 style="padding:0;margin:5px;">{{vm.data.name|uppercase}}</h4>
    <img src="images/4stars.png" style="width:110px;height:50px;">
    <h6 style="padding:0;margin:0px;"> Address: {{vm.data.address}}<br></h6>
        <h6 style="padding:0;margin:0px;"> Opening hours<br></h6>
    <div style="padding-left: 30px;">
   <i> Mon-Fri: 6 - 22<br>
    Sat-Sun: 12 - 18</i>
        </div>

</div>


<script>
    var map;
    function initMap() {
        var marker1;
        var marker2;
        var mypos;
        console.log("here in map");
        var myLatlng = new google.maps.LatLng(latitude,longitude);
         map = new google.maps.Map(document.getElementById('map'), {

            center: {lat:latitude, lng:longitude },
            zoom: 18
        }),
                directionsService = new google.maps.DirectionsService,
                directionsDisplay = new google.maps.DirectionsRenderer({
                    map: map
                }),
                marker1 = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                    title: 'Hello World!',
                    icon:'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
                });


        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
               var  pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                 mypos=new google.maps.LatLng( position.coords.latitude, position.coords.longitude);
                console.log("The lat and long "+pos.lat + " "+pos.lng);
                calculateAndDisplayRoute(directionsService, directionsDisplay, mypos, myLatlng);
            });
        }
        marker2 = new google.maps.Marker({
            position: mypos,
            map: map
        });




    }
    function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB) {
        directionsService.route({
            origin: pointA,
            destination: pointB,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        }, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                var step=parseInt(response.routes[0].legs[0].steps.length);
                var location=Math.round( step/2 )
                console.log("the steps"+ step);
                var distance=response.routes[0].legs[0].distance.value;
                var time=response.routes[0].legs[0].duration.text;
                var infoContent="Distance: "+ distance/1000+" Km"+"<br>"+"Driving time: "+ time;
                var infoWindow=new google.maps.InfoWindow({
                    content:infoContent

                });
                infoWindow.setPosition(response.routes[0].legs[0].steps[location].end_location);
                infoWindow.open(map);

                $('#distance').append(distance/1000+" Km");

            } else {
                window.alert('Directions request failed due to ' + status);
            }
        });
    }

</script>



</body>
</html>
